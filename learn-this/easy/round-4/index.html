<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><title>Pack everything before space jump</title><link rel="stylesheet" href="/css/normalize.css"><link rel="stylesheet" href="/css/header-footer.css"><link rel="stylesheet" href="/css/syntax.css"><link rel="stylesheet" href="/css/learn-this/learn-this-page.css"><link rel="icon" type="image/png" href="/images/favicon.png"><link href='http://fonts.googleapis.com/css?family=Titillium+Web:400,700,300,200' rel='stylesheet' type='text/css'> <script>!function(e,a,n,t,o,c,s){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=a.createElement(n),s=a.getElementsByTagName(n)[0],c.async=1,c.src=t,s.parentNode.insertBefore(c,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-40112459-1","joybox.io"),ga("send","pageview")</script><script src="/scripts/jquery-2.0.3.min.js"></script></head><body> <header> <nav> <a title="JOYBOX" href="/"><img src="/images/logo-header.png"></a><ul><li><a title="GET STARTED" href="/get-started">GET STARTED</a></li><li><a title="DOCUMENTATION" href="/documentation">DOCUMENTATION</a></li><li><a title="LEARN THIS" href="/learn-this">LEARN THIS</a></li><li><a title="HIGH SCORES" href="/high-scores">HIGH SCORES</a></li><li><a title="VERSION HISTORY" href="/version-history">VERSION HISTORY</a></li><li><a title="HELP" href="https://groups.google.com/forum/#!forum/joybox-wrapper">HELP</a></li></ul> </nav> </header><section id="title"><h1>Learn This!</h1> </section> <section id="blog"> <section id="theme" style="background:url('/images/tutorial-easy.png') no-repeat center 20px ,#600"><h4>Round 4: Tutorial<span>Game Architecture</span></h4><p>This tutorial will help us in the process of creating a new sprite sheet and how to create new sprites using it.</p> <a href="/learn-this/easy">Return to Easy Path</a> </section> <section id="content"><h4>SPRITE SHEETS</h4> <article><h2>Pack everything before space jump</h2><p><p>The last time we look at our game we have an empty implementation of the game scene, if we open our <strong>game_scene.rb</strong> file, it should look something like the following:</p><div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">GameScene</span> <span class="o">&lt;</span> <span class="no">Joybox</span><span class="o">::</span><span class="no">Core</span><span class="o">::</span><span class="no">Scene</span>

  <span class="k">def</span> <span class="nf">on_enter</span>
  <span class="k">end</span>

<span class="k">end</span>
</code></pre></div><p>Let's download the <a href="../../../downloads/learn-this/easy/round-4/assets.zip">Round 4 Assets</a> and upzip them, inside we will find two folders:</p><ul><li><strong>Game</strong> - This folder should be copied into the resources folder of our game.</li><li><strong>Sprite Sheet</strong> - We will use this folder a little bit later when we create our sprite sheet.</li></ul><p>Now we can start working on the Game Scene creating a background for it, please create a new file named <strong>background_layer.rb</strong> inside our layers folder and place the following inside it:</p><div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">BackgroundLayer</span> <span class="o">&lt;</span> <span class="no">Joybox</span><span class="o">::</span><span class="no">Core</span><span class="o">::</span><span class="no">Layer</span>

  <span class="k">def</span> <span class="nf">on_enter</span>
    <span class="n">background_sprite</span> <span class="o">=</span> <span class="no">Sprite</span><span class="o">.</span><span class="n">new</span> <span class="n">file_name</span><span class="p">:</span> <span class="s1">'sprites/game/background.png'</span><span class="p">,</span> <span class="ss">position</span><span class="p">:</span> <span class="no">Screen</span><span class="o">.</span><span class="n">center</span>
    <span class="nb">self</span> <span class="o">&lt;&lt;</span> <span class="n">background_sprite</span>
  <span class="k">end</span>

<span class="k">end</span>
</code></pre></div><p><img class='more-info' src='/images/moreinfo.png'/> For more information about the Sprite, see: <a href="../../../documentation/sprite">Sprite documentation page</a>.</p><p><img class='more-info' src='/images/moreinfo.png'/> For more information about the Layer, see: <a href="../../../documentation/layer">Layer documentation page</a>.</p><p>As we already know we need to present it on the Game Scene and this is done by adding the following into the <strong>game_scene.rb</strong> file:</p><div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">GameScene</span> <span class="o">&lt;</span> <span class="no">Joybox</span><span class="o">::</span><span class="no">Core</span><span class="o">::</span><span class="no">Scene</span>

  <span class="k">def</span> <span class="nf">on_enter</span>
    <span class="n">background_layer</span> <span class="o">=</span> <span class="no">BackgroundLayer</span><span class="o">.</span><span class="n">new</span>
    <span class="nb">self</span> <span class="o">&lt;&lt;</span> <span class="n">background_layer</span>
  <span class="k">end</span>

<span class="k">end</span>
</code></pre></div><p><img class='more-info' src='/images/moreinfo.png'/> For more information about the Scene, see: <a href="../../../documentation/scene">Scene documentation page</a>.</p><p>And if we run our game and press the <strong>touch to start</strong> button:</p><p><img src="../../../images/learn-this/easy/round-4/background.png" alt="Background"/></p><h3 id=game-layer>Game Layer</h3><p>It's time to create a new layer that will help us with loading the core pieces of our game (Asteroids and the Space Ship) and handling the interaction of the user at game time, please create a new file inside the layers folder with the name <strong>game_layer.rb</strong>:</p><div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">GameLayer</span> <span class="o">&lt;</span> <span class="no">Joybox</span><span class="o">::</span><span class="no">Core</span><span class="o">::</span><span class="no">Layer</span>

  <span class="k">def</span> <span class="nf">on_enter</span>
  <span class="k">end</span>

<span class="k">end</span>
</code></pre></div><p>And present it on the <strong>game_scene.rb</strong> changing the following:</p><div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">GameScene</span> <span class="o">&lt;</span> <span class="no">Joybox</span><span class="o">::</span><span class="no">Core</span><span class="o">::</span><span class="no">Scene</span>

  <span class="k">def</span> <span class="nf">on_enter</span>
    <span class="n">background_layer</span> <span class="o">=</span> <span class="no">BackgroundLayer</span><span class="o">.</span><span class="n">new</span>
    <span class="nb">self</span> <span class="o">&lt;&lt;</span> <span class="n">background_layer</span>

    <span class="n">game_layer</span> <span class="o">=</span> <span class="no">GameLayer</span><span class="o">.</span><span class="n">new</span>
    <span class="nb">self</span> <span class="o">&lt;&lt;</span> <span class="n">game_layer</span>
  <span class="k">end</span>

<span class="k">end</span>
</code></pre></div><p>Well is not a mistery that if we run the game at this time we should not see any diference at all, so lets add a sprite to the <strong>game_layer.rb</strong>:</p><div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">on_enter</span>
  <span class="n">test_sprite</span> <span class="o">=</span> <span class="no">Sprite</span><span class="o">.</span><span class="n">new</span> <span class="n">file_name</span><span class="p">:</span> <span class="s1">'sprites/game/asteroid-large.png'</span><span class="p">,</span> <span class="ss">position</span><span class="p">:</span> <span class="no">Screen</span><span class="o">.</span><span class="n">center</span>
  <span class="nb">self</span> <span class="o">&lt;&lt;</span> <span class="n">test_sprite</span>
<span class="k">end</span>
</code></pre></div><p>If we run our game we should see the following when we hit the <strong>touch to start</strong> button:</p><p><img src="../../../images/learn-this/easy/round-4/asteroid.png" alt="Asteroid"/></p><div class='flag warning'><h5>Watch out!</h5><br/><p>Please take notice that we are loading the sprite the same way that we are presenting the backgrounds.</p></div><p>As we see in the previous round videos using standard images to load the game sprites is very dangerous in terms of performance and memory, which at the long term (Presenting more than 20 sprites on the screen) will make our game feel like is shuttering. They way to go at this point is to build a sprite sheet and load the asteroids using it!</p><h3 id=build-the-sprite-sheet>Build the Sprite Sheet</h3><p>In order to create an Sprite Sheet we need to use an external application, the most populars for this are <a href="http://www.codeandweb.com/texturepacker">TexturePacker</a> and <a href="http://www.zwopple.com/zwoptex/">Zwoptex</a>. For the rest of the tutorial I will use Zwoptex but you can go with either of them.</p><p>After installing them the first step is create a new document, which should look as the following:</p><p><img src="../../../images/learn-this/easy/round-4/new-document.png" alt="New Document"/></p><p>The next step is to add the images that we want to be included in the sprite sheet, for this lets open the resources that we previously downloaded and drag and drop all the images that are contained in the <strong>Sprite Sheet/Regular</strong> folder into the Library Section of the application:</p><p><img src="../../../images/learn-this/easy/round-4/add-images.png" alt="Add Images"/></p><div class='flag warning'><h5>Watch out!</h5><br/><p>You should not add the retina images to this sprite sheet. It will be needed to build two different sprite sheets: the retina and the normal.</p></div><p>Now on the <strong>Document menu</strong> of the application which is on the left side, lets configure the size we want for our sprite sheet, in this case 256px x 256px:</p><p><img src="../../../images/learn-this/easy/round-4/sprite-sheet-size.png" alt="Sprite Sheet Size"/></p><p>Its time to order all the images into the sprite sheet, you can do it manually but is best to use the <strong>Layout</strong> button in the top menu:</p><p><img src="../../../images/learn-this/easy/round-4/layout.png" alt="Layout"/></p><p>Before we can export the sprite sheet they are a couple of steps we need to do first, please save the sprite sheet with the name <strong>game</strong> and open the publish settings (There is a button on the top right side of the application).</p><p>We need to change two things on the <strong>Publish Settings</strong>, the first is on the bottom right part, change the <strong>Cordinates Format</strong> to cocos2d (.plist):</p><p><img src="../../../images/learn-this/easy/round-4/coordinates-format.png" alt="Coordinates Format"/></p><p>The second is on the left part change the <strong>target name</strong> from default to <strong>sprite_sheet</strong> by doble clicking it:</p><p><img src="../../../images/learn-this/easy/round-4/target.png" alt="Target"/></p><p>Save the settings by clicking the done button and <strong>publish</strong> the sprite sheet using the button on the top menu, after the export we should have two different files: <strong>game_sprite_sheet.png</strong> and <strong>game_sprite_sheet.plist</strong>:</p><ul><li><strong>Plist</strong> - Contains all the metadata of the images and their respective coordinates inside the sprite sheet.</li><li><strong>PNG</strong> - Is the image that we previusly layout inside the application.</li></ul><p>This two files are our sprite sheet, to continue please create a new folder named sprite_sheets inside the game's resource folder and copy this two files inside it.</p><div class='flag'><h5>Level Up!</h5><br/><p>Analyze the contents of the Plist file.</p></div><h3 id=use-the-sprite-sheet>Use the Sprite Sheet</h3><p>In order to use our new sprite sheet we have to tell the game which sprite sheet to load and its respective metadata, for this two objects are needed: <strong>SpriteBatch</strong> and <strong>SpriteFrameCache</strong>. We can start implementing it by open the <strong>game_layer.rb</strong> and addign the following:</p><div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">GameLayer</span> <span class="o">&lt;</span> <span class="no">Joybox</span><span class="o">::</span><span class="no">Core</span><span class="o">::</span><span class="no">Layer</span>

  <span class="k">def</span> <span class="nf">on_enter</span>
    <span class="no">SpriteFrameCache</span><span class="o">.</span><span class="n">frames</span><span class="o">.</span><span class="n">add</span> <span class="n">file_name</span><span class="p">:</span> <span class="s1">'sprite_sheets/game_sprite_sheet.plist'</span>
  <span class="k">end</span>

<span class="k">end</span>
</code></pre></div><p>In this code we are telling the game that we want to add the sprite sheet frames (metadata) to the game cache, now we can load the sprite sheet image:</p><div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">GameLayer</span> <span class="o">&lt;</span> <span class="no">Joybox</span><span class="o">::</span><span class="no">Core</span><span class="o">::</span><span class="no">Layer</span>

  <span class="k">def</span> <span class="nf">on_enter</span>
    <span class="no">SpriteFrameCache</span><span class="o">.</span><span class="n">frames</span><span class="o">.</span><span class="n">add</span> <span class="n">file_name</span><span class="p">:</span> <span class="s1">'sprite_sheets/game_sprite_sheet.plist'</span>

    <span class="vi">@sprite_batch</span> <span class="o">=</span> <span class="no">SpriteBatch</span><span class="o">.</span><span class="n">new</span> <span class="n">file_name</span><span class="p">:</span> <span class="s2">"sprite_sheets/game_sprite_sheet.png"</span>
    <span class="nb">self</span> <span class="o">&lt;&lt;</span> <span class="vi">@sprite_batch</span>
  <span class="k">end</span>

<span class="k">end</span>
</code></pre></div><div class='flag info'><h5>More intel!</h5><br/><p>We are adding the SpriteBatch object as a child of the layer.</p></div><p>We create a new <strong>SpriteBatch</strong> object passing the sprite sheet image as parameter, now is time to load our sprite asteroid. Please take a close look at the following code:</p><div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">GameLayer</span> <span class="o">&lt;</span> <span class="no">Joybox</span><span class="o">::</span><span class="no">Core</span><span class="o">::</span><span class="no">Layer</span>

  <span class="k">def</span> <span class="nf">on_enter</span>
    <span class="no">SpriteFrameCache</span><span class="o">.</span><span class="n">frames</span><span class="o">.</span><span class="n">add</span> <span class="n">file_name</span><span class="p">:</span> <span class="s1">'sprite_sheets/game_sprite_sheet.plist'</span>

    <span class="vi">@sprite_batch</span> <span class="o">=</span> <span class="no">SpriteBatch</span><span class="o">.</span><span class="n">new</span> <span class="n">file_name</span><span class="p">:</span> <span class="s2">"sprite_sheets/game_sprite_sheet.png"</span>
    <span class="nb">self</span> <span class="o">&lt;&lt;</span> <span class="vi">@sprite_batch</span>

    <span class="n">test_sprite</span> <span class="o">=</span> <span class="no">Sprite</span><span class="o">.</span><span class="n">new</span> <span class="n">frame_name</span><span class="p">:</span> <span class="s1">'asteroid-large.png'</span><span class="p">,</span> <span class="ss">position</span><span class="p">:</span> <span class="no">Screen</span><span class="o">.</span><span class="n">center</span>
    <span class="vi">@sprite_batch</span> <span class="o">&lt;&lt;</span> <span class="n">test_sprite</span>
  <span class="k">end</span>

<span class="k">end</span>
</code></pre></div><p>When we create the sprite we are not telling anymore which image should it use, instead we are using a <strong>frame_name</strong>, this value is contained in the <strong>Plist metadata file</strong> and usually is the name of the image imported into the texture application.</p><p>But how the game knows from which image it should load the frame?, If you look closelly you can see that we are not adding the sprite to the layer anymore, instead we are adding the sprite to the sprite batch object which cointains the sprite sheet image.</p><p>In a nutshell the Sprite has a frame name, the SpriteFrameCache knows every frame in the sprite sheet and the SpriteBatch contains the corresponding image for those frames.</p><p><img class='more-info' src='/images/moreinfo.png'/> For more information about the SpriteFrameCache, see: <a href="../../../documentation/sprite-frame-cache">Sprite Frame Cache documentation page</a>.</p><p><img class='more-info' src='/images/moreinfo.png'/> For more information about the SpriteBatch, see: <a href="../../../documentation/sprite-batch">Sprite Batch documentation page</a>.</p><div class='flag warning'><h5>Watch out!</h5><br/><p>You will only need one Sprite Batch object for all the sprites in a layer or scene.</p></div><div class='flag'><h5>Level Up!</h5><br/><p>You can change the frame name altering the Plist file.</p></div><p>If we run our game now and press the <strong>touch to start</strong> button, we should see the following:</p><p><img src="../../../images/learn-this/easy/round-4/asteroid.png" alt="Asteroid"/></p><h3 id=round->Round 5</h3><p>Not really a big change but now we are a little more safe on the memory and performance side, in the next round we will continue building the asteroids game logic. For the moment a little challenge:</p><p>Build the retina display sprite sheet and test it by presenting three different asteroids on the screen.</p><p><img class='more-info' src='/images/moreinfo.png'/> You can download the source code of this round from: <a href="../../../downloads/learn-this/easy/round-4/asteroids.zip">Easy Level - Round 4</a></p></p> </article><div class="previous"><a href="/learn-this/easy/round-3">PREVIOUS</a></div><div class="next"><a href="/learn-this/easy/round-5">NEXT</a></div> </section> </section><section id="buildings"> <img src="/images/buildings-footer.png"> </section> <footer> <section id="container"> <img src="/images/star-footer.png"><p>Joybox is distributed under the terms of the MIT License<br>Design by: <a href="http://sandradelare.com/">Sandra de la Re</a></p> </section> </footer></body></html>